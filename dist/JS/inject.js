(()=>{console.log("AutoMade script loaded"),console.log("inject.js loaded"),window.addEventListener("load",(()=>{t.fullyLoaded=!0}));let e={body:document.body,highlight:document.createElement("div"),styles:document.createElement("style"),highlightElement:e=>{o.getElement(e).classList.add("highlightElem")},returnElement:t=>{e.body.style="";let n=o.getElement(t);n.addEventListener("animationiteration",(()=>{n.classList.remove("highlightElem")}),{once:!0})}},t={continue:void 0,fullyLoaded:!1,browserOS:void 0,port:chrome.runtime.connect({name:location.href}),targetElement:void 0,keyCodes:{Enter:13}},o={actionQueue:[],parsePacket:e=>{if(1!==e.v)throw new Error("Packet version not supported");for(let t of e.actions)console.log(t),o.throwAction(t)},throwAction:e=>{if(console.log("throwing action"),console.log(`State is ${document.readyState}`),"complete"===document.readyState)switch(e.type){case"click":console.log("Running click action"),console.log(`Element Specifier is ${e.specifier}`);let t=o.getElement(e.specifier);console.log(t),t.dispatchEvent(new MouseEvent("click",{bubbles:!0,cancelable:!0,view:window})),t.focus(),console.log("click event dispatched");break;case"input":console.log("Running input action"),o.enterText(o.getElement(e.specifier),e);break;case"key":console.log("Running key action"),o.enterKey(o.getElement(e.specifier),e.key)}else o.actionQueue.push(e)},enterText:(e,t)=>{console.log("typing"),console.log(t);let n,l=t.text.split(""),c=[0,0];console.log(e),console.log("Typing the text: "+t.text),n="true"==e.contentEditable?(t,o)=>{let n,l=0,c=(o[1],o[0],window.getSelection()),i=document.createRange();e.innerHTML=e.innerHTML+t,n=e.childNodes[0],l=t.length,i.setStart(n,l),i.collapse(!0),c.removeAllRanges(),c.addRange(i);const a=new Event("input",{bubbles:!0});e.dispatchEvent(a)}:(t,o)=>{console.log("elemnt value is "+e.value),e.focus(),e.value=e.value.substring(0,o[0])+t+e.value.substring(o[1]),e.setSelectionRange(o[0]+1,o[0]+1)};for(let t of l)console.log(t),n(t,c),c=[c[0]+1,c[0]+1],o.enterKey(e,t)},enterKey:(e,o)=>{let n=o.length>1?t.keyCodes[o]:o,l={key:o,code:o,which:n,keyCode:n,composed:!0,bubbles:!0,cancelable:!0};console.log(l),e.dispatchEvent(new KeyboardEvent("keydown",l)),e.dispatchEvent(new KeyboardEvent("keypress",l)),e.dispatchEvent(new KeyboardEvent("keyup",l)),e.dispatchEvent(new InputEvent("input",{data:o,inputType:"insertText",bubbles:!0}))},runQueue:()=>{for(let e of o.actionQueue)o.throwAction(e);o.actionQueue=[]},getElement:e=>{if(0==e.indexOf("--")){let t=e.indexOf("$"),o=Number(e.substring(2,t));return e=e.substring(t+1),document.querySelectorAll(e)[o]}{let t=document.querySelectorAll(e);if(1===t.length)return t[0];throw t.length>1?new Error("Multiple Elements found"):new Error("Element not found")}}},n={keyTable:[{mac:{key:"v",metaKey:!0},default:{key:"v",ctrlKey:!0},getKeyData:()=>({})},{mac:{key:"z",metaKey:!0},default:{key:"z",ctrlKey:!0},getKeyData:()=>({key:"undo"})},{mac:{key:"z",metaKey:!0,shiftKey:!0},default:{key:"y",ctrlKey:!0},getKeyData:()=>({key:"redo"})},{mac:{key:"x",metaKey:!0},default:{key:"x",ctrlKey:!0},getKeyData:e=>({key:"cut",selection:n.getSelection(e.target)})},{mac:{key:"a",metaKey:!0},default:{key:"a",ctrlKey:!0},getKeyData:()=>({key:"all"})}],templates:{click:{action:"log",type:"click",specifier:void 0,textContext:void 0},input:{action:"log",specifier:void 0,key:void 0}},matchKeys:(e,t)=>{let o=Object.keys(t);for(let n of o)if(e[n]!=t[n])return!1;return!0},eventHandler:async e=>{let o,l=e.target;if("click"==e.type)o={...n.templates.click},o.specifier=n.getSpecifier(l),"INPUT"==l.tagName||"TEXTAREA"==l.tagName?(o.textContext=l.value,t.targetElement=o.specifier):"true"==l.contentEditable&&(o.textContext=l.innerText,t.targetElement=o.specifier);else if("keydown"==e.type||"keyup"==e.type||"keypress"==e.type)if(o={...n.templates.input},o.specifier=null!=t.targetElement?t.targetElement:n.getSpecifier(l),o.type="key",(e.metaKey||e.ctrlKey)&&1==e.key.length){console.log(t.browserOS),console.log(e);for(let l of n.keyTable)if(console.log(l[t.browserOS]),n.matchKeys(e,l[t.browserOS])){console.log(l[t.browserOS]),Object.assign(o,await l.getKeyData(e));break}console.log("Prepost",e),console.log("Post parse",o)}else e.key.length>1?"Enter"==e.key&&(o.key="Enter"):1==e.key.length&&(console.log("key is "+e.key),o.type="input",o.key=e.key,o.selection=n.getSelection(e.target));console.log(o),("key"==o.type&&null!=o.key||"key"!=o.type)&&t.port.postMessage(o)},getSelection:e=>{if("INPUT"==e.tagName&&"text"==e.type||"TEXTAREA"==e.tagName)return e.selectionStart+"-"+e.selectionEnd;{let e=window.getSelection();return e.baseOffset>e.extentOffset?e.extentOffset+"-"+e.baseOffset:e.baseOffset+"-"+e.extentOffset}},getSpecifier:e=>{let t=e.tagName;e:{let o;if(e.id.length>0){if(t+=`#${e.id}`,o=document.querySelectorAll(t),1===o.length)break e}else if(e.classList.length>0&&(t+=`.${e.classList[0]}`,o=document.querySelectorAll(t),1===o.length))break e;t=`--${[...o].indexOf(e)}$${t}`}return t}};document.onreadystatechange=()=>{"complete"===document.readyState&&console.log("Document fully loaded"),"complete"===document.readyState&&o.actionQueue.length>0&&o.runQueue()},t.port.onMessage.addListener((function(l){switch(l.action){case"startRecord":document.addEventListener("click",n.eventHandler),document.addEventListener("keydown",n.eventHandler),document.addEventListener("paste",(e=>{let o={type:"key",selection:n.getSelection(e.target),key:"paste",text:e.clipboardData.getData("text/plain")};""!=text&&null!=text&&t.port.postMessage(o)}));break;case"stopRecord":document.removeEventListener("click",n.eventHandler),document.removeEventListener("keydown",n.eventHandler);break;case"highlight":console.log(l);let c=document.getElementById(l.id);c.classList.add("highlight"),setTimeout((()=>{c.classList.remove("highlight")}),1e3);break;case"action":console.log("completing Action"),o.throwAction(l),t.port.postMessage({action:"resolve"});break;case"actionPacket":console.log("completing Action Packet"),console.log(l),o.parsePacket(l);break;case"openEditor":if(!e.editor)throw new Error("Editor not found");console.log("Editor Opened"),console.log(l.actionSet),e.editor.openEditor(l.actionSet),e.editor.showEntry();break;case"closeEditor":if(!e.editor)throw new Error("Editor not found");console.log("Editor Closed"),t.port.postMessage({action:"closedEditor",actionList:e.editor.hideEditor()});break;case"setURL":location.href=l.url}})),-1!=navigator.userAgent.indexOf("Macintosh")?t.browserOS="mac":t.browserOS="default"})();