(()=>{console.log("ActionEcho script loaded"),console.log("inject.js loaded"),window.addEventListener("load",(()=>{t.fullyLoaded=!0}));let e={body:document.body,indicator:document.createElement("div"),highlight:document.createElement("div"),toggleIndicator:t=>{t?e.indicator.style="right:10px; z-index: 100000;":(e.indicator.style.right="-100px",setTimeout((()=>{e.indicator.style.zIndex="-100000"}),500))},highlightElement:e=>{o.getElement(e).classList.add("highlightElem")},returnElement:t=>{e.body.style="";let l=o.getElement(t);l.addEventListener("animationiteration",(()=>{l.classList.remove("highlightElem")}),{once:!0})}},t={continue:void 0,fullyLoaded:!1,browserOS:void 0,port:chrome.runtime.connect({name:location.href}),targetElement:void 0,keyCodes:{Enter:13}},o={actionQueue:[],data:{focusedElement:void 0,range:[0,0]},parsePacket:e=>{if(1!==e.v)throw new Error("Packet version not supported");for(let t of e.actions)console.log(t),o.throwAction(t)},throwAction:e=>{if(console.log("throwing action"),console.log(`State is ${document.readyState}`),"complete"===document.readyState)switch(e.type){case"click":console.log("Running click action"),console.log(`Element Specifier is ${e.specifier}`);let t=o.getElement(e.specifier);if(console.log(t),o.data.focusedElement=t,console.log("%c Checking Input","background-color: red; font-size: 20px;"),"INPUT"==t.tagName||"TEXTAREA"==t.tagName?t.value=e.textContext:"true"==t.contentEditable&&(t.innerText=e.textContext),e.caret){let l=e.caret.split("-");o.setFocus(t,l)}t.dispatchEvent(new MouseEvent("click",{bubbles:!0,cancelable:!0,view:window})),t.focus(),console.log("click event dispatched");break;case"input":console.log("Running input action"),o.enterText(o.data.focusedElement,e);break;case"key":console.log("Running key action"),o.enterKey(o.getElement(e.specifier),e.key)}else o.actionQueue.push(e)},enterText:(e,t)=>{console.log("typing"),console.log(t);let l,n=t.text.split(""),c=o.data.range;console.log(e),console.log("Typing the text: "+t.text),l="true"==e.contentEditable?(t,l)=>{let n,c=0;e.innerHTML=e.innerHTML+t,n=e.childNodes[0],c=t.length,o.setFocus(e,l);const i=new Event("input",{bubbles:!0});e.dispatchEvent(i)}:(t,o)=>{console.log("elemnt value is "+e.value),e.focus(),e.value=e.value.substring(0,o[0])+t+e.value.substring(o[1]),e.setSelectionRange(o[0]+1,o[0]+1)};for(let t of n)console.log(t),l(t,c),c=[c[0]+1,c[0]+1],o.enterKey(e,t)},enterKey:(e,o)=>{let l=o.length>1?t.keyCodes[o]:o,n={key:o,code:o,which:l,keyCode:l,composed:!0,bubbles:!0,cancelable:!0};console.log(n),e.dispatchEvent(new KeyboardEvent("keydown",n)),e.dispatchEvent(new KeyboardEvent("keypress",n)),e.dispatchEvent(new KeyboardEvent("keyup",n)),e.dispatchEvent(new InputEvent("input",{data:o,inputType:"insertText",bubbles:!0}))},runQueue:()=>{for(let e of o.actionQueue)o.throwAction(e);o.actionQueue=[]},getElement:e=>{if(0==e.indexOf("--")){let t=e.indexOf("$"),o=Number(e.substring(2,t));return e=e.substring(t+1),document.querySelectorAll(e)[o]}{let t=document.querySelectorAll(e);if(1===t.length)return t[0];throw t.length>1?new Error("Multiple Elements found"):new Error("Element not found")}},setFocus(e,t){if(t||"true"===e.contentEditable){if("input"===e.tagName&&"text"===e.type||"TEXTAREA"===e.tagName)e.setSelectionRange(t[0],t[1]);else if("true"===e.contentEditable){let t=window.getSelection(),o=document.createRange();o.setStart(e,o[0]),o.setEnd(e,o[1]),t.removeAllRanges(),t.addRange(o)}}else e.focus()}},l={keyTable:[{mac:{key:"v",metaKey:!0},default:{key:"v",ctrlKey:!0},getKeyData:()=>({})},{mac:{key:"z",metaKey:!0},default:{key:"z",ctrlKey:!0},getKeyData:()=>({key:"undo"})},{mac:{key:"z",metaKey:!0,shiftKey:!0},default:{key:"y",ctrlKey:!0},getKeyData:()=>({key:"redo"})},{mac:{key:"x",metaKey:!0},default:{key:"x",ctrlKey:!0},getKeyData:e=>({key:"cut",selection:l.getSelection(e.target)})},{mac:{key:"a",metaKey:!0},default:{key:"a",ctrlKey:!0},getKeyData:()=>({key:"all"})}],templates:{click:{action:"log",type:"click",specifier:void 0,textContext:void 0},input:{action:"log",specifier:void 0,key:void 0}},matchKeys:(e,t)=>{let o=Object.keys(t);for(let l of o)if(e[l]!=t[l])return!1;return!0},eventHandler:async e=>{let o,n=e.target;if(console.log(e),"click"==e.type)o={...l.templates.click},o.specifier=l.getSpecifier(n),("INPUT"==n.tagName&&"text"==n.type||"TEXTAREA"==n.tagName||"true"==n.contentEditable)&&(o.textContext="true"==n.contentEditable?n.innerText:n.value,o.caret=l.getSelection(n),t.targetElement=o.specifier);else if("keydown"==e.type||"keyup"==e.type||"keypress"==e.type)if(o={...l.templates.input},o.specifier=null!=t.targetElement?t.targetElement:l.getSpecifier(n),o.type="key",(e.metaKey||e.ctrlKey)&&1==e.key.length){console.log(t.browserOS),console.log(e);for(let n of l.keyTable)if(console.log(n[t.browserOS]),l.matchKeys(e,n[t.browserOS])){console.log(n[t.browserOS]),Object.assign(o,await n.getKeyData(e));break}console.log("Prepost",e),console.log("Post parse",o)}else e.key.length>1?"Enter"==e.key?o.key="Enter":"Backspace"==e.key?o.key="Backspace":"Delete"==e.key?o.key="Delete":"ArrowLeft"==e.key?o.key="ArrowLeft":"ArrowRight"==e.key&&(o.key="ArrowRight"):1==e.key.length&&(console.log("key is "+e.key),o.type="input",o.key=e.key,o.selection=l.getSelection(e.target));console.log(o),("key"==o.type&&null!=o.key||"key"!=o.type)&&t.port.postMessage(o)},getSelection:e=>{if("INPUT"==e.tagName&&"text"==e.type||"TEXTAREA"==e.tagName)return e.selectionStart+"-"+e.selectionEnd;{let e=window.getSelection();return e.baseOffset>e.extentOffset?e.extentOffset+"-"+e.baseOffset:e.baseOffset+"-"+e.extentOffset}},getSpecifier:e=>{let t=e.tagName;e:{let o;if(e.id.length>0){if(t+=`#${e.id}`,o=document.querySelectorAll(t),1===o.length)break e}else if(e.classList.length>0&&(t+=`.${e.classList[0]}`,o=document.querySelectorAll(t),1===o.length))break e;t=`--${[...o].indexOf(e)}$${t}`}return t}};document.onreadystatechange=()=>{"complete"===document.readyState&&console.log("Document fully loaded"),"complete"===document.readyState&&o.actionQueue.length>0&&o.runQueue()},t.port.onMessage.addListener((function(n){switch(n.action){case"startRecord":e.toggleIndicator(!0),document.addEventListener("click",l.eventHandler),document.addEventListener("keydown",l.eventHandler),document.addEventListener("paste",(e=>{let o={type:"key",selection:l.getSelection(e.target),key:"paste",text:e.clipboardData.getData("text/plain")};""!=text&&null!=text&&t.port.postMessage(o)}));break;case"stopRecord":e.toggleIndicator(!1),document.removeEventListener("click",l.eventHandler),document.removeEventListener("keydown",l.eventHandler);break;case"highlight":console.log(n);let c=document.getElementById(n.id);c.classList.add("highlight"),setTimeout((()=>{c.classList.remove("highlight")}),1e3);break;case"action":console.log("completing Action"),o.throwAction(n),t.port.postMessage({action:"resolve"});break;case"actionPacket":console.log("completing Action Packet"),console.log(n),o.parsePacket(n);break;case"openEditor":if(!e.editor)throw new Error("Editor not found");console.log("Editor Opened"),console.log(n.actionSet),e.editor.openEditor(n.actionSet),e.editor.showEntry();break;case"closeEditor":if(!e.editor)throw new Error("Editor not found");console.log("Editor Closed"),t.port.postMessage({action:"closedEditor",actionList:e.editor.hideEditor()});break;case"setURL":location.href=n.url}})),-1!=navigator.userAgent.indexOf("Macintosh")?t.browserOS="mac":t.browserOS="default",e.indicator.classList.add("actionEchoRecordIcon"),e.indicator.innerHTML='<svg style="height:60px; width: 60px;" viewBox="0 0 1200 1200" xmlns="http://www.w3.org/2000/svg">\n<path d="m557.75 583.42c-39.443-39.443-103.39-39.443-142.84 0s-39.443 103.39 0 142.84 103.39 39.443 142.84 0 39.443-103.39 0-142.84zm-25.456 25.456c-25.384-25.384-66.54-25.384-91.924 0s-25.384 66.539 0 91.923c25.384 25.385 66.54 25.385 91.924 0 25.384-25.384 25.384-66.539 0-91.923z" clip-rule="evenodd" fill="#D9D9D9" fill-rule="evenodd"/>\n<path d="m557.75 583.42c-39.443-39.443-103.39-39.443-142.84 0s-39.443 103.39 0 142.84 103.39 39.443 142.84 0 39.443-103.39 0-142.84zm-25.456 25.456c-25.384-25.384-66.54-25.384-91.924 0s-25.384 66.539 0 91.923c25.384 25.385 66.54 25.385 91.924 0 25.384-25.384 25.384-66.539 0-91.923z" clip-rule="evenodd" fill-opacity=".3" fill-rule="evenodd"/>\n<path d="m70.556 958.89 111.02 111.02 314.54-314.55c-29.002 2.805-58.986-6.899-81.198-29.111-22.615-22.615-32.264-53.287-28.945-82.777l-315.42 315.42z" fill="#D9D9D9"/>\n<path d="m70.556 958.89 111.02 111.02 314.54-314.55c-29.002 2.805-58.986-6.899-81.198-29.111-22.615-22.615-32.264-53.287-28.945-82.777l-315.42 315.42z" fill-opacity=".3"/>\n<path d="m982.64 158.42c-39.443-39.443-103.39-39.443-142.84 0-39.443 39.443-39.443 103.39 0 142.84 39.442 39.443 103.39 39.443 142.84 0 39.441-39.443 39.441-103.39 0-142.84zm-25.456 25.456c-25.384-25.384-66.54-25.384-91.924 0s-25.384 66.539 0 91.924c25.384 25.384 66.54 25.384 91.924 0 25.384-25.385 25.384-66.54 0-91.924z" clip-rule="evenodd" fill="#D9D9D9" fill-rule="evenodd"/>\n<path d="m982.64 158.42c-39.443-39.443-103.39-39.443-142.84 0-39.443 39.443-39.443 103.39 0 142.84 39.442 39.443 103.39 39.443 142.84 0 39.441-39.443 39.441-103.39 0-142.84zm-25.456 25.456c-25.384-25.384-66.54-25.384-91.924 0s-25.384 66.539 0 91.924c25.384 25.384 66.54 25.384 91.924 0 25.384-25.385 25.384-66.54 0-91.924z" clip-rule="evenodd" fill-opacity=".15" fill-rule="evenodd"/>\n<path d="m495.44 533.89 111.02 111.02 314.54-314.54c-29.003 2.805-58.986-6.899-81.198-29.111-22.616-22.615-32.264-53.287-28.946-82.777l-315.42 315.42z" fill="#D9D9D9"/>\n<path d="m495.44 533.89 111.02 111.02 314.54-314.54c-29.003 2.805-58.986-6.899-81.198-29.111-22.616-22.615-32.264-53.287-28.946-82.777l-315.42 315.42z" fill-opacity=".15"/>\n<path d="m413.42 727.64c39.443 39.443 103.39 39.443 142.84 0s39.443-103.39 0-142.84-103.39-39.443-142.84 0-39.443 103.39 0 142.84zm25.456-25.456c25.384 25.384 66.54 25.384 91.924 0s25.384-66.54 0-91.924-66.54-25.384-91.924 0-25.384 66.54 0 91.924z" clip-rule="evenodd" fill="#D9D9D9" fill-rule="evenodd"/>\n<path d="m413.42 727.64c39.443 39.443 103.39 39.443 142.84 0s39.443-103.39 0-142.84-103.39-39.443-142.84 0-39.443 103.39 0 142.84zm25.456-25.456c25.384 25.384 66.54 25.384 91.924 0s25.384-66.54 0-91.924-66.54-25.384-91.924 0-25.384 66.54 0 91.924z" clip-rule="evenodd" fill-opacity=".15" fill-rule="evenodd"/>\n<path d="m900.62 352.16-111.02-111.02-314.54 314.54c29.003-2.805 58.987 6.898 81.199 29.11 22.615 22.616 32.264 53.288 28.945 82.778l315.42-315.42z" fill="#D9D9D9"/>\n<path d="m900.62 352.16-111.02-111.02-314.54 314.54c29.003-2.805 58.987 6.898 81.199 29.11 22.615 22.616 32.264 53.288 28.945 82.778l315.42-315.42z" fill-opacity=".15"/>\n<path d="m982.64 158.42c-39.443-39.443-103.39-39.443-142.84 0-39.443 39.443-39.443 103.39 0 142.84 39.442 39.443 103.39 39.443 142.84 0 39.441-39.443 39.441-103.39 0-142.84zm-25.456 25.456c-25.384-25.384-66.54-25.384-91.924 0s-25.384 66.539 0 91.924c25.384 25.384 66.54 25.384 91.924 0 25.384-25.385 25.384-66.54 0-91.924z" clip-rule="evenodd" fill="#D9D9D9" fill-rule="evenodd"/>\n<path d="m982.64 158.42c-39.443-39.443-103.39-39.443-142.84 0-39.443 39.443-39.443 103.39 0 142.84 39.442 39.443 103.39 39.443 142.84 0 39.441-39.443 39.441-103.39 0-142.84zm-25.456 25.456c-25.384-25.384-66.54-25.384-91.924 0s-25.384 66.539 0 91.924c25.384 25.384 66.54 25.384 91.924 0 25.384-25.385 25.384-66.54 0-91.924z" clip-rule="evenodd" fill-opacity=".15" fill-rule="evenodd"/>\n<path d="m495.44 533.89 111.02 111.02 314.54-314.54c-29.003 2.805-58.986-6.899-81.198-29.111-22.616-22.615-32.264-53.287-28.946-82.777l-315.42 315.42z" fill="#D9D9D9"/>\n<path d="m495.44 533.89 111.02 111.02 314.54-314.54c-29.003 2.805-58.986-6.899-81.198-29.111-22.616-22.615-32.264-53.287-28.946-82.777l-315.42 315.42z" fill-opacity=".15"/>\n<path d="m413.42 727.64c39.443 39.443 103.39 39.443 142.84 0s39.443-103.39 0-142.84-103.39-39.443-142.84 0-39.443 103.39 0 142.84zm25.456-25.456c25.384 25.384 66.54 25.384 91.924 0s25.384-66.54 0-91.924-66.54-25.384-91.924 0-25.384 66.54 0 91.924z" clip-rule="evenodd" fill="#D9D9D9" fill-rule="evenodd"/>\n<path d="m413.42 727.64c39.443 39.443 103.39 39.443 142.84 0s39.443-103.39 0-142.84-103.39-39.443-142.84 0-39.443 103.39 0 142.84zm25.456-25.456c25.384 25.384 66.54 25.384 91.924 0s25.384-66.54 0-91.924-66.54-25.384-91.924 0-25.384 66.54 0 91.924z" clip-rule="evenodd" fill-opacity=".15" fill-rule="evenodd"/>\n<path d="m900.62 352.16-111.02-111.02-314.54 314.54c29.003-2.805 58.987 6.898 81.199 29.11 22.615 22.616 32.264 53.288 28.945 82.778l315.42-315.42z" fill="#D9D9D9"/>\n<path d="m900.62 352.16-111.02-111.02-314.54 314.54c29.003-2.805 58.987 6.898 81.199 29.11 22.615 22.616 32.264 53.288 28.945 82.778l315.42-315.42z" fill-opacity=".15"/>\n<path d="m911 130c-55.781 0-101 45.219-101 101s45.219 101 101 101 101-45.219 101-101-45.223-101-101-101zm0 36c-35.899 0-65 29.102-65 65s29.101 65 65 65c35.898 0 65-29.102 65-65s-29.102-65-65-65z" clip-rule="evenodd" fill="#D9D9D9" fill-rule="evenodd"/>\n<path d="m832 740h157v-444.83c-18.524 22.492-46.588 36.832-78 36.832-31.983 0-60.494-14.866-79-38.065v446.06z" fill="#D9D9D9"/>\n<path d="m910.77 1112.2-202.46-376.66h404.92l-202.46 376.66z" fill="#D9D9D9"/>\n<circle cx="911" cy="230" r="45" fill="#D9D9D9"/>\n<circle cx="487" cy="655" r="45" fill="#D9D9D9"/>">\n<span class="actionEchoToolTip">Recording</span>\n',e.body.appendChild(e.indicator),console.log(e.indicator)})();