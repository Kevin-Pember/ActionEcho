(()=>{let e={actionsData:[],scheduledEvents:[],months:["January","February","March","April","May","June","July","August","September","October","November","December"],saveActionList(){chrome.storage.local.set({actionSets:this.actionsData})},addAction(e){this.actionsData.length>=10&&this.actionsData.pop(),this.actionsData.unshift(e),t.createActionEntry(e),this.saveActionList()},removeAction(e){this.actionsData.splice(this.actionsData.indexOf(e),1),this.saveActionList()},removeScheduledAction(e){0==t.scheduleButtons.length&&(t.eventsStage.style.visibility="hidden",t.eventsStage.style.position="absolute"),chrome.runtime.sendMessage({action:"removeScheduledAction",id:e.id},(e=>{})),this.scheduledEvents.splice(this.scheduledEvents.indexOf(e),1)},clearActionList(){chrome.storage.local.clear((function(){var e=chrome.runtime.lastError;e&&console.error(e)}));for(let e of t.actionButtons)e.remove()}},t={backgroundDiv:document.getElementById("bgDiv"),recordStart:document.getElementById("recordStart"),recordStop:document.getElementById("recordStop"),editBack:document.getElementById("editBack"),editSave:document.getElementById("editSave"),editNameEntry:document.getElementById("editName"),editEntryContainer:document.getElementById("editEntry"),uniEntry:document.getElementById("uniPopup"),actionsNone:document.getElementById("actionsNone"),eventsStage:document.getElementById("eventsStage"),dial:document.getElementById("dial"),actionButtons:[],scheduleButtons:[],setPage:e=>{let t=document.getElementsByClassName("contentPage");for(let n of t)n.id==e?n.classList.remove("hiddenPage"):n.classList.add("hiddenPage")},getName:e=>new Promise(((n,o)=>{t.uniEntry.setQueryType("text",e),t.uniEntry.style.top="0px",t.backgroundDiv.blurFocus(),t.uniEntry.setMethods(((e,i)=>{console.log("Complete called as: "+e),t.uniEntry.style.top="100%",t.backgroundDiv.returnFocus(),e?n(i):o()}))})),getBool:(e,n)=>new Promise(((o,i)=>{t.uniEntry.setQueryType("bool",e,n),t.uniEntry.style.top="0px",t.backgroundDiv.blurFocus(),t.uniEntry.setMethods(((e,n)=>{t.uniEntry.style.top="100%",t.backgroundDiv.returnFocus(),e?o(n):i()}))})),getTime:e=>new Promise(((n,o)=>{t.uniEntry.setQueryType("time",e),t.uniEntry.style.top="0px",t.backgroundDiv.blurFocus(),t.uniEntry.setMethods(((e,i,s)=>{t.uniEntry.style.top="100%",t.backgroundDiv.returnFocus(),e?n(s?"now":i):o()}))})),createActionEntry(e){let n=document.createElement("action-set");n.linkAction(e),t.actionButtons.push(n);let o=document.getElementById("historyBar");"hidden"!=t.actionsNone.style.visibility&&(t.actionsNone.style="visibility: hidden; position: absolute;"),o.insertBefore(n,o.firstChild)},createTimeEntry(e){console.log("creating time entry");let n=document.createElement("scheduled-action");Date.now()>=Number(e.date)&&(e.state="failed"),n.linkAction(e),t.eventsStage.appendChild(n),t.scheduleButtons.push(n),console.log(t.eventsStage.style.visibility),"inherit"!=t.eventsStage.style.visibility&&(t.eventsStage.style.visibility="inherit",t.eventsStage.style.position="inherit")},faviconURL(e){const t=new URL(chrome.runtime.getURL("/_favicon/"));return t.searchParams.set("pageUrl",e),t.searchParams.set("size","32"),t.toString()}};chrome.storage.local.get(["actionSets"]).then((n=>{if(console.log(n),e.actionsData=null==n.actionSets?[]:n.actionSets,null!=n.actionSets&&Array.isArray(n.actionSets)&&n.actionSets.length>0)for(let n of e.actionsData.reverse())t.createActionEntry(n)})),chrome.storage.local.get(["scheduledEvents"]).then((e=>{if(console.log(e),null!=e.scheduledEvents)for(let n of e.scheduledEvents)t.createTimeEntry(n)})),chrome.storage.local.get(["recording"]).then((e=>{console.log(e),1==e.recording&&t.setPage("recordPage")})),t.recordStart.addEventListener("click",(()=>{console.log("Starting recording"),chrome.runtime.sendMessage({action:"startRecord"},(e=>{if("started"!=e.log)throw new Error("Failed to start recording");console.log("Started recording"),chrome.storage.local.set({recording:!0}).then((()=>{t.setPage("recordPage")}))}))})),t.recordStop.addEventListener("click",(()=>{chrome.storage.local.set({recording:!1}).then((()=>{t.setPage("mainPage")})),chrome.runtime.sendMessage({action:"stopRecord"},(n=>{if("finished"!=n.log)throw new Error("Failed to stop recording");console.log("Stopped recording"),n.actions.length>0&&t.getName("Enter Name").then((t=>{e.addAction({name:t,actions:n.actions,urls:n.urls})}),(()=>{}))}))})),chrome.runtime.sendMessage({action:"init"},(e=>{for(let n of e.lists)t.createTimeEntry(n)})),chrome.runtime.onMessage.addListener(((e,n,o)=>{let i;console.log("messaged"),"changeSchedule"===e.action&&(i=t.scheduleButtons.find((t=>t.event.id==e.id)),i.setIcon(e.state),o({log:"added"}))})),chrome.storage.local.get(["signed"]).then((e=>{console.log(e),"true"!=e.signed&&(t.tosPrompt=async()=>{t.getBool("User Agreement",'<h2>Sensitive Data</h2>Please be advised that the use of this extension for passwords or any \n      other sensitive data is strictly prohibited. This extension does not \n      provide adequate security measures and should not be relied upon for \n      securing sensitive information. It is important to note that this extension \n      is intended solely for the storage of non-sensitive data. \n      <br><br><h2>Liability</h2>This extension is \n      provided "AS IS", without warranty of any kind, express or implied, including \n      but not limited to the warranties of merchantability, fitness for a particular \n      purpose, and noninfringement. In no event shall the authors or copyright holders\n      be liable for any claim, damages, or other liability, whether in an action of \n      contract, tort, or otherwise, arising from, out of, or in connection with the \n      software or the use or other dealings in the software.').then((e=>{console.log(e),e?chrome.storage.local.set({signed:"true"}):t.tosReject()}))},t.tosReject=async()=>{t.getBool("User Agreement Rejected","You have rejected the User Agreement. \n      This extension will not function if you don't accept the User Agreement.\n      Please either accept the User Agreement or uninstall the extension.\n      ").then((e=>{e?t.tosPrompt():(chrome.storage.local.set({signed:"false"}),t.recordStart.remove())}))}),null==e.signed?t.tosPrompt():"false"==e.signed&&t.tosReject()}))})();